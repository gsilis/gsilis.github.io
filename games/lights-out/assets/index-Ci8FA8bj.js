var L=Object.defineProperty;var y=(s,o,i)=>o in s?L(s,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[o]=i;var e=(s,o,i)=>y(s,typeof o!="symbol"?o+"":o,i);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const p of r)if(p.type==="childList")for(const c of p.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function i(r){const p={};return r.integrity&&(p.integrity=r.integrity),r.referrerPolicy&&(p.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?p.credentials="include":r.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function n(r){if(r.ep)return;r.ep=!0;const p=i(r);fetch(r.href,p)}})();class f{static createFor(o,i){return new f(o,i)}constructor(o,i){this._x=o,this._y=i}get x(){return this._x}get y(){return this._y}compare(o){return o.x==this.x&&o.y==this.y}}class t{static pointFor(o,i){return this.pool[o]=this.pool[o]||[],this.pool[o][i]=this.pool[o][i]||new f(o,i),this.pool[o][i]}}e(t,"pool",[]);class _{constructor(o,i,n){e(this,"buttons",[]);e(this,"elements",[]);e(this,"onSelect",o=>{const i=o.detail.point,n=new CustomEvent("SELECT",{detail:{point:i}});this.dispatcher.dispatchEvent(n)});e(this,"toggle",o=>{this.buttonAt(o).toggle()});e(this,"buttonAt",o=>{const{x:i,y:n}=o;return this.buttons[n]&&this.buttons[n][i]||this.nullButton});e(this,"applyData",o=>{this.clear(),o.forEach(i=>this.toggle(i))});e(this,"clear",()=>{this.elements.forEach(o=>o.on=!1)});e(this,"checkedPoints",()=>this.checked().map(o=>o.point));e(this,"checked",()=>this.elements.filter(o=>o.on));e(this,"checkedCount",()=>this.checked().length);e(this,"addEventListener",(...o)=>this.dispatcher.addEventListener(...o));e(this,"removeEventListener",(...o)=>this.dispatcher.removeEventListener(...o));this.dispatcher=new EventTarget,this.buttonFactory=n,this.width=o,this.height=i,this.nullButton=this.buttonFactory.createNull(),window.grid=this}setup(){this.buttons=[];for(let o=0;o<this.height;o++){const i=[];for(let n=0;n<this.width;n++){const r=t.pointFor(n,o),p=this.buttonFactory.create(r);p.addEventListener("CLICK",this.onSelect),i[n]=p,this.elements.push(p)}this.buttons[o]=i}}}const l={WIDTH:5,HEIGHT:5,START_LEVEL:1};class g{constructor(o,i,n,r,p,c){this.setState=o,this.pushState=i,this.popState=n,this.grid=r,this.session=p,this.stateFactory=c}setup(){}onSelect(o){}onHint(){}onReset(){}teardown(){}pause(){}resume(){}withOptions(){}}class S extends g{getSequence(){return this.sequence}onSelect(){}teardown(){}}const w=[t.pointFor(0,0),t.pointFor(1,0),t.pointFor(2,0),t.pointFor(3,0),t.pointFor(4,0),t.pointFor(4,1),t.pointFor(4,2),t.pointFor(4,3),t.pointFor(4,4),t.pointFor(3,4),t.pointFor(2,4),t.pointFor(1,4),t.pointFor(0,4),t.pointFor(0,3),t.pointFor(0,2),t.pointFor(0,1),t.pointFor(1,1),t.pointFor(2,1),t.pointFor(3,1),t.pointFor(3,2),t.pointFor(3,3),t.pointFor(2,3),t.pointFor(1,3),t.pointFor(1,2),t.pointFor(2,2)];class v{constructor(o){e(this,"steps",[]);e(this,"tickNotifiers",[]);e(this,"completionNotifiers",[]);e(this,"index",-1);e(this,"interval",null);e(this,"onInterval",()=>{const o=this.steps[this.index],i=this.steps[++this.index];if(this.steps.length<=this.index){this.pause(),this.completionNotifiers.forEach(r=>r.call(void 0,this));return}this.tickNotifiers.forEach(r=>r.call(void 0,i,o,this))});this.stepDurationMS=o}static create(o){return new v(o)}addSteps(...o){return this.steps.push(...o),this}tick(o){return this.tickNotifiers.push(o),this}done(o){return this.completionNotifiers.push(o),this}run(){return this.interval=setInterval(this.onInterval,this.stepDurationMS),this}pause(){return clearInterval(this.interval),this.interval=null,this}reset(){return this.currentIndex=-1,this}removeNotifier(o){const i=this.tickNotifiers.indexOf(o),n=this.completionNotifiers.indexOf(o);i>-1&&this.tickNotifiers.splice(i,1),n>-1&&this.completionNotifiers.splice(n,1)}}const d=function(o,i){const n=o.length;let r=i%n;return r<0&&(r=n+r),o[r]};class x extends S{constructor(){super(...arguments);e(this,"complete",()=>{this.setState(this.stateFactory.create(h.LEVEL_SELECT_ANIMATION))});e(this,"teardown",()=>{this.grid.clear(),this.sequence.pause()});e(this,"onSelect",i=>{this.complete()})}setup(){const i=d(w,-1);this.sequence=v.create(100).addSteps(...w).tick((n,r)=>{r&&this.grid.toggle(r),this.grid.toggle(n)}).done(()=>{this.grid.toggle(i),this.complete()}).run()}}class F{constructor(o,i){e(this,"repetitive");e(this,"points",[]);e(this,"moves",[]);this.points=o,this.moves=i}addPoint(o){this.points.push(o)}addMove(o){this.moves.push(o)}isRepetitious(){if(this.repetitive!==void 0)return this.repetitive;const o={};return this.repetitive=this.moves.reduce((i,n)=>{const r=`${n.x}|${n.y}`;return!i&&o[r]&&(i=!0),o[r]=!0,i},!1),this.repetitive}}const A=new F([t.pointFor(2,2),t.pointFor(1,2),t.pointFor(3,2),t.pointFor(2,1),t.pointFor(2,3)],[t.pointFor(2,2)]),I=new F([t.pointFor(0,2),t.pointFor(2,2),t.pointFor(4,2)],[t.pointFor(0,3),t.pointFor(2,3),t.pointFor(4,3),t.pointFor(0,4),t.pointFor(2,4),t.pointFor(4,4)]),N=new F([t.pointFor(2,0),t.pointFor(3,0),t.pointFor(4,0),t.pointFor(0,1),t.pointFor(0,2),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(0,3),t.pointFor(2,4),t.pointFor(3,4),t.pointFor(4,4)],[t.pointFor(0,2),t.pointFor(3,4),t.pointFor(3,0),t.pointFor(3,2)]),M=new F([t.pointFor(1,0),t.pointFor(0,1),t.pointFor(2,1),t.pointFor(3,1),t.pointFor(0,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(1,3),t.pointFor(2,4),t.pointFor(3,4),t.pointFor(4,4)],[t.pointFor(1,2),t.pointFor(3,1),t.pointFor(3,2),t.pointFor(3,4),t.pointFor(1,1),t.pointFor(3,1)]),O=new F([t.pointFor(1,0),t.pointFor(3,0),t.pointFor(0,1),t.pointFor(2,1),t.pointFor(3,1),t.pointFor(4,1),t.pointFor(0,2),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(2,3),t.pointFor(3,3),t.pointFor(1,4),t.pointFor(3,4)],[t.pointFor(3,1),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(2,4),t.pointFor(1,1),t.pointFor(2,3)]),b=new F([t.pointFor(2,0),t.pointFor(1,1),t.pointFor(3,1),t.pointFor(3,2),t.pointFor(0,3),t.pointFor(1,3),t.pointFor(3,3),t.pointFor(1,4),t.pointFor(2,4),t.pointFor(3,4),t.pointFor(4,4)],[t.pointFor(2,1),t.pointFor(2,3),t.pointFor(1,3),t.pointFor(2,2),t.pointFor(2,3),t.pointFor(3,4)]),T=new F([t.pointFor(0,0),t.pointFor(1,0),t.pointFor(3,0),t.pointFor(4,0),t.pointFor(1,1),t.pointFor(3,1),t.pointFor(4,1),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(1,3),t.pointFor(4,4)],[t.pointFor(4,4),t.pointFor(2,2),t.pointFor(1,2),t.pointFor(4,0),t.pointFor(0,1),t.pointFor(1,1),t.pointFor(3,2),t.pointFor(3,3)]),R=new F([t.pointFor(2,0),t.pointFor(3,0),t.pointFor(4,1),t.pointFor(0,2),t.pointFor(3,2),t.pointFor(0,3),t.pointFor(2,3),t.pointFor(1,4)],[t.pointFor(3,3),t.pointFor(1,3),t.pointFor(3,1),t.pointFor(2,1),t.pointFor(3,3),t.pointFor(1,2)]),C=new F([t.pointFor(0,0),t.pointFor(1,0),t.pointFor(3,0),t.pointFor(4,0),t.pointFor(1,1),t.pointFor(1,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(0,3),t.pointFor(1,3),t.pointFor(0,4)],[t.pointFor(2,0),t.pointFor(1,0),t.pointFor(4,3),t.pointFor(1,4),t.pointFor(2,3),t.pointFor(4,3),t.pointFor(3,2),t.pointFor(2,2),t.pointFor(2,0),t.pointFor(2,2),t.pointFor(1,3),t.pointFor(3,0)]),$=new F([t.pointFor(1,1),t.pointFor(2,1),t.pointFor(0,2),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(1,3),t.pointFor(4,3),t.pointFor(0,4),t.pointFor(2,4),t.pointFor(3,4)],[t.pointFor(1,2),t.pointFor(1,3),t.pointFor(0,4),t.pointFor(3,3),t.pointFor(2,3),t.pointFor(2,2)]),k=new F([t.pointFor(2,0),t.pointFor(3,0),t.pointFor(0,1),t.pointFor(3,1),t.pointFor(4,1),t.pointFor(1,2),t.pointFor(1,3),t.pointFor(3,3),t.pointFor(4,3),t.pointFor(1,4),t.pointFor(3,4)],[t.pointFor(0,2),t.pointFor(0,3),t.pointFor(3,3),t.pointFor(3,2),t.pointFor(2,3),t.pointFor(3,0),t.pointFor(1,4),t.pointFor(4,1)]),H=new F([t.pointFor(0,0),t.pointFor(1,0),t.pointFor(2,0),t.pointFor(3,0),t.pointFor(0,1),t.pointFor(1,1),t.pointFor(2,1),t.pointFor(3,1),t.pointFor(4,1),t.pointFor(0,2),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(0,3),t.pointFor(1,3),t.pointFor(4,3),t.pointFor(0,4)],[t.pointFor(0,3),t.pointFor(2,1),t.pointFor(2,0),t.pointFor(1,0),t.pointFor(4,2),t.pointFor(1,1)]),D=new F([t.pointFor(0,0),t.pointFor(1,0),t.pointFor(2,0),t.pointFor(3,0),t.pointFor(4,0),t.pointFor(0,1),t.pointFor(1,1),t.pointFor(3,1),t.pointFor(4,1),t.pointFor(0,2),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(2,3)],[t.pointFor(2,0),t.pointFor(2,2),t.pointFor(4,1),t.pointFor(0,1)]),P=new F([t.pointFor(0,2),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(1,3),t.pointFor(0,4),t.pointFor(1,4),t.pointFor(3,4),t.pointFor(4,4)],[t.pointFor(3,4),t.pointFor(2,3),t.pointFor(1,3),t.pointFor(0,3)]),q=new F([t.pointFor(1,0),t.pointFor(2,0),t.pointFor(0,1),t.pointFor(0,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(2,3),t.pointFor(3,3),t.pointFor(0,4),t.pointFor(1,4)],[t.pointFor(1,1),t.pointFor(3,2),t.pointFor(2,1),t.pointFor(1,3),t.pointFor(0,3)]),V=new F([t.pointFor(1,0),t.pointFor(1,1),t.pointFor(2,1),t.pointFor(4,1),t.pointFor(3,2),t.pointFor(1,3),t.pointFor(2,3),t.pointFor(3,4),t.pointFor(4,4)],[t.pointFor(2,3),t.pointFor(3,1),t.pointFor(2,1),t.pointFor(3,4),t.pointFor(2,0)]),B=new F([t.pointFor(2,0),t.pointFor(4,0),t.pointFor(2,1),t.pointFor(4,1),t.pointFor(4,2),t.pointFor(1,3),t.pointFor(2,3),t.pointFor(0,4),t.pointFor(1,4),t.pointFor(2,4),t.pointFor(3,4),t.pointFor(4,4)],[t.pointFor(3,3),t.pointFor(3,0),t.pointFor(1,4),t.pointFor(4,3),t.pointFor(3,1)]),G=new F([t.pointFor(1,1),t.pointFor(2,1),t.pointFor(0,2),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(0,3),t.pointFor(1,3),t.pointFor(2,3),t.pointFor(4,3),t.pointFor(1,4),t.pointFor(2,4),t.pointFor(4,4)],[t.pointFor(1,3),t.pointFor(2,3),t.pointFor(2,2),t.pointFor(1,2),t.pointFor(4,3)]),W=new F([t.pointFor(0,0),t.pointFor(1,0),t.pointFor(3,0),t.pointFor(4,0),t.pointFor(0,2),t.pointFor(1,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(0,3),t.pointFor(1,3),t.pointFor(3,3),t.pointFor(0,4),t.pointFor(1,4)],[t.pointFor(3,2),t.pointFor(1,2),t.pointFor(1,0),t.pointFor(3,0),t.pointFor(0,4)]),K=new F([t.pointFor(1,0),t.pointFor(3,0),t.pointFor(4,0),t.pointFor(0,1),t.pointFor(1,1),t.pointFor(2,1),t.pointFor(4,1),t.pointFor(1,2),t.pointFor(3,2),t.pointFor(0,3),t.pointFor(1,3),t.pointFor(2,3),t.pointFor(1,4)],[t.pointFor(3,3),t.pointFor(3,1),t.pointFor(4,4),t.pointFor(2,2),t.pointFor(1,2),t.pointFor(3,0),t.pointFor(3,4),t.pointFor(2,4),t.pointFor(0,2),t.pointFor(2,0)]),Y=new F([t.pointFor(0,1),t.pointFor(1,1),t.pointFor(2,1),t.pointFor(3,1),t.pointFor(0,2),t.pointFor(2,2),t.pointFor(3,2),t.pointFor(0,3),t.pointFor(2,3),t.pointFor(4,3),t.pointFor(0,4),t.pointFor(3,4)],[t.pointFor(3,3),t.pointFor(0,0),t.pointFor(2,1),t.pointFor(1,4),t.pointFor(2,3),t.pointFor(1,3),t.pointFor(1,2),t.pointFor(1,0)]),j=new F([t.pointFor(1,0),t.pointFor(2,0),t.pointFor(4,0),t.pointFor(0,1),t.pointFor(2,1),t.pointFor(3,1),t.pointFor(4,1),t.pointFor(2,2),t.pointFor(3,2),t.pointFor(4,2),t.pointFor(2,3),t.pointFor(2,4),t.pointFor(3,4),t.pointFor(4,4)],[t.pointFor(0,3),t.pointFor(2,0),t.pointFor(0,2),t.pointFor(3,2),t.pointFor(3,4),t.pointFor(4,0),t.pointFor(0,4),t.pointFor(1,3)]),U=new F([t.pointFor(1,0),t.pointFor(2,0),t.pointFor(3,0),t.pointFor(4,0),t.pointFor(1,1),t.pointFor(2,1),t.pointFor(4,1),t.pointFor(0,2),t.pointFor(3,2),t.pointFor(0,3),t.pointFor(1,3),t.pointFor(2,3),t.pointFor(3,3),t.pointFor(1,4)],[t.pointFor(2,3),t.pointFor(0,2),t.pointFor(3,0),t.pointFor(2,4),t.pointFor(3,3),t.pointFor(4,2),t.pointFor(3,2),t.pointFor(1,1)]),z=new F([t.pointFor(0,0),t.pointFor(1,0),t.pointFor(2,0),t.pointFor(3,0),t.pointFor(0,1),t.pointFor(1,1),t.pointFor(2,1),t.pointFor(3,1),t.pointFor(4,1),t.pointFor(0,2),t.pointFor(1,2),t.pointFor(2,2),t.pointFor(4,2),t.pointFor(0,3),t.pointFor(1,3),t.pointFor(3,3),t.pointFor(4,3),t.pointFor(0,4),t.pointFor(2,4),t.pointFor(4,4)],[t.pointFor(2,1),t.pointFor(2,2),t.pointFor(3,3),t.pointFor(0,0),t.pointFor(3,1),t.pointFor(3,4),t.pointFor(0,3),t.pointFor(3,2)]),J=new F([t.pointFor(0,0),t.pointFor(1,0),t.pointFor(4,0),t.pointFor(2,1),t.pointFor(0,2),t.pointFor(1,2),t.pointFor(4,2),t.pointFor(1,3),t.pointFor(2,3),t.pointFor(3,3)],[t.pointFor(3,2),t.pointFor(4,2),t.pointFor(3,4),t.pointFor(4,4),t.pointFor(0,1),t.pointFor(1,1),t.pointFor(4,1),t.pointFor(2,3)]),Q=[A,I,N,M,O,b,T,R,C,$,k,H,D,P,q,V,B,G,W,K,Y,j,U,z,J];class X extends g{constructor(){super(...arguments);e(this,"rightMoves",[]);e(this,"wrongMoves",[]);e(this,"snapshot",[])}setup(){const i=this.session.level.getCurrentValue();this.levelData=Q[i],this.grid.applyData(this.levelData.points)}onSelect(i){const n=i.detail.point,r=d(this.wrongMoves,-1)===n,p=this.levelData.moves[this.rightMoves.length]===n;r?this.wrongMoves.pop():p?this.rightMoves.push(n):this.wrongMoves.push(n),[n,t.pointFor(n.x,n.y-1),t.pointFor(n.x,n.y+1),t.pointFor(n.x-1,n.y),t.pointFor(n.x+1,n.y)].forEach(this.grid.toggle),this.grid.checkedCount()===0&&(this.grid.clear(),this.session.level.update(this.session.level.getCurrentValue()+1),this.setState(this.stateFactory.create(h.LEVEL_SELECT_ANIMATION)))}onReset(){this.setState(this.stateFactory.create(h.PLAY))}onHint(){this.pushState(this.stateFactory.create(h.HINT,this.grid.checkedPoints(),this.levelData.moves,this.rightMoves,this.wrongMoves))}pause(){this.snapshot=this.grid.checkedPoints()}resume(){this.grid.clear(),this.grid.applyData(this.snapshot)}}class Z extends g{onSelect(o){const i=o.detail.point,n=this.points.indexOf(i);if(n<0){this.pushState(this.stateFactory.create(h.ERROR_ANIMATION));return}this.session.level.update(n),this.setState(this.stateFactory.create(h.PLAY))}setup(){const o=this.session.maxLevel.getCurrentValue();let i=0;for(this.points=[];i<=o;){const n=i%l.WIDTH,r=Math.floor(i/l.WIDTH);this.points.push(t.pointFor(n,r)),i++}this.grid.clear(),this.points.forEach(n=>{this.grid.toggle(n)})}teardown(){this.grid.clear()}resume(){this.grid.clear(),this.grid.applyData(this.points)}onHint(){this.pushState(this.stateFactory.create(h.ERROR_ANIMATION))}onReset(){this.pushState(this.stateFactory.create(h.ERROR_ANIMATION))}}const u=[t.pointFor(0,0),t.pointFor(1,1),t.pointFor(2,2),t.pointFor(3,3),t.pointFor(4,4),t.pointFor(4,0),t.pointFor(3,1),t.pointFor(1,3),t.pointFor(0,4)],tt=[u,u,u,u,u,u];class ot extends S{constructor(){super(...arguments);e(this,"teardown",()=>{this.sequence.pause(),this.grid.clear()})}setup(){this.grid.clear(),this.sequence=v.create(200).addSteps(...tt).tick(i=>{i.forEach(n=>this.grid.toggle(n))}).done(()=>{this.popState()}).run()}}class it extends S{constructor(){super(...arguments);e(this,"complete",()=>{this.setState(this.stateFactory.create(h.PLAY))});e(this,"onSelect",()=>{this.complete()});e(this,"teardown",()=>{this.sequence.pause(),this.grid.clear()})}setup(){const i=this.session.level.getCurrentValue(),n=i%l.WIDTH,r=Math.floor(i/l.HEIGHT),p=t.pointFor(n,r);this.sequence=v.create(200).addSteps(p,p,p,p,p,p,p,p).tick(c=>{this.grid.toggle(c)}).done(this.complete).run()}}class nt extends g{withOptions(o,i,n,r){this.snapshot=o,this.rightMoves=n,this.wrongMoves=r,this.moves=i}setup(){const o=d(this.wrongMoves,-1),i=this.moves[this.rightMoves.length],n=o||i;if(!n){this.setState(this.stateFactory.create(h.ERROR_ANIMATION));return}this.grid.clear(),this.grid.applyData(this.snapshot),this.sequence=v.create(200).addSteps(n,n,n,n,n,n).tick(r=>{this.grid.toggle(r)}).done(()=>{this.popState()}).run()}onSelect(){this.sequence.pause(),this.popState()}teardown(){this.sequence.pause()}}const et={SPIRAL_ANIMATION:x,LEVEL_SELECT_ANIMATION:it,ERROR_ANIMATION:ot,PLAY:X,LEVEL_SELECT:Z,HINT:nt},h=et;class rt{constructor(o,i,n,r,p){this.setState=o,this.pushState=i,this.popState=n,this.grid=r,this.session=p}create(o,...i){const n=typeof o=="function"&&o||g,r=new n(this.setState,this.pushState,this.popState,this.grid,this.session,this);return r.withOptions(...i),r}}const st=function(o,i){const n=[];for(let r=0;r<o;r++)n.push(i);return n};class m{constructor(o){e(this,"_value",null);e(this,"_observers",[]);this._value=o}getCurrentValue(){return this._value}observe(o){return this._observers.push(o),o.call(void 0,this._value),this}update(o){return this._value=o,this._observers.forEach(i=>i.call(void 0,o)),this}}class pt{constructor(){e(this,"maxLevel",new m(0));e(this,"level",new m(0));e(this,"solved",st(l.WIDTH*l.HEIGHT,!1));e(this,"interactive",new m(!1))}setup(){this.level.observe(o=>{const i=this.maxLevel.getCurrentValue();o>i&&this.maxLevel.update(o)})}}class E{constructor(o,i){e(this,"_active",!1);e(this,"toggle",()=>{this.on=!this.on});e(this,"click",()=>{const o=new CustomEvent("CLICK",{detail:{point:this._point}});this.dispatcher.dispatchEvent(o)});e(this,"addEventListener",(...o)=>this.dispatcher.addEventListener(...o));e(this,"removeEventListener",(...o)=>this.dispatcher.removeEventListener(...o));this.dispatcher=new EventTarget,this._on=!1,this._stage=o,this._point=i,this._html=document.createElement("button"),this._html.setAttribute("data-x",this._point.x),this._html.setAttribute("data-y",this._point.y),this._stage.appendChild(this._html),this._html.addEventListener("click",this.click)}get active(){return this._active}set active(o){this._active=o,this._html.disabled=!this._active}get on(){return this._on}set on(o){this._on=o,this._on?this._html.classList.add("on"):this._html.classList.remove("on")}get point(){return this._point}}class Ft{constructor(o){this.stage=o}createNull(){return new E(document.createElement("div"),t.pointFor(-1,-1))}create(o){return new E(this.stage,o)}}class ht{constructor(o,i,n,r){e(this,"onLevelSelect",()=>{this.setState(this.stateFactory.create(h.LEVEL_SELECT))});e(this,"setState",o=>{const i=this.state.pop();i&&i.teardown(),o.setup(),this.state.push(o)});e(this,"pushState",o=>{const i=d(this.state,-1);i&&i.pause.call(i),o.setup(),this.state.push(o)});e(this,"popState",()=>{const o=this.state.pop(),i=d(this.state,-1);o&&o.teardown.call(o),i&&i.resume.call(i)});e(this,"getLatestState",()=>d(this.state,-1));e(this,"onSelect",(...o)=>{const i=this.getLatestState();return i.onSelect.call(i,...o)});e(this,"onHint",(...o)=>{const i=this.getLatestState();return i.onHint.call(i,...o)});e(this,"onReset",(...o)=>{const i=this.getLatestState();return i.onReset.call(i,...o)});this.state=[],this.session=new pt,this.session.setup(),this.domGrid=o,this.domSelect=i,this.domReset=n,this.domHint=r,this.buttonFactory=new Ft(this.domGrid),this.grid=new _(l.WIDTH,l.HEIGHT,this.buttonFactory),this.stateFactory=new rt(this.setState,this.pushState,this.popState,this.grid,this.session),this.grid.setup(),this.grid.addEventListener("SELECT",this.onSelect),this.domSelect.addEventListener("click",this.onLevelSelect),this.domReset.addEventListener("click",this.onReset),this.domHint.addEventListener("click",this.onHint),this.setState(this.stateFactory.create(h.SPIRAL_ANIMATION))}}class ct{constructor(...o){e(this,"listeners",[]);this.index=0,this.steps=o}onComplete(o){this.listeners.push(o)}next(...o){this.steps[this.index].call(void 0,...o)?(this.index+=1,this.index>=this.steps.length&&this.complete()):this.index=0}complete(){this.index=0,this.listeners.forEach(o=>o.call(void 0))}}const a=s=>o=>o.key===s;class at{constructor(){e(this,"listeners",[]);e(this,"onKey",o=>{this.chain.next(o)});e(this,"observe",o=>{this.listeners.push(o)});e(this,"unobserve",o=>{this.listeners=this.listeners.filter(i=>i!==o)});e(this,"notify",()=>{this.listeners.forEach(o=>o.call(void 0))});window.addEventListener("keyup",this.onKey),this.chain=new ct(a("ArrowUp"),a("ArrowUp"),a("ArrowDown"),a("ArrowDown"),a("ArrowLeft"),a("ArrowRight"),a("ArrowLeft"),a("ArrowRight"),a("a"),a("b")),this.chain.onComplete(this.notify)}}function lt(){const s=document.getElementById("game-reset"),o=document.getElementById("game-select"),i=document.getElementById("game-hint"),n=document.querySelector("#app .grid"),r=new ht(n,o,s,i),p=new at,c=()=>{r.session.maxLevel.update(25),alert("All levels unlocked!"),p.unobserve(c)};p.observe(c)}document.addEventListener("DOMContentLoaded",function s(){document.removeEventListener("DOMContentLoaded",s),lt()});
